----------------------------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  E:\users\amy.mason\Pipeline_27_07_2016\analysis3.log
  log type:  text
 opened on:  13 Oct 2016, 17:41:44

. noi di "Run by AMM on $S_DATE $S_TIME"
Run by AMM on 13 Oct 2016 17:41:44

. cd E:\users\amy.mason\Pipeline_27_07_2016\Datasets
E:\users\amy.mason\Pipeline_27_07_2016\Datasets

. 
. *********** create virulence predictions by site
. use viru_panel_all, clear

. 
. ******************************************************
. noi di _n(5) _dup(80) "=" _n " 1 virulence predictions by site" _n _dup(80) "="





================================================================================
 1 virulence predictions by site
================================================================================

. 
. noi di" make bar chart of which methods differ on which virulence factor"
 make bar chart of which methods differ on which virulence factor

. preserve

. contract  site  value*

. rename valueall all

. drop value*

. 
. reshape wide _freq, i(site) j(all) string
(note: j = aaa apa app ppa ppp)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       66   ->      19
Number of variables                   3   ->       6
j variable (5 values)               all   ->   (dropped)
xij variables:
                                  _freq   ->   _freqaaa _freqapa ... _freqppp
-----------------------------------------------------------------------------

. rename _freq* *

. 
. 
. * bar graph of predictions (antibiotics)
. #delimit ;
delimiter now ;
. graph bar (asis) ppp app ppa apa aaa,  over(site, label(angle(90))) stack title("Combinations of Results") subtitle("Results giv
> en as Genefinder Mykrobe Typewriter ") 
> legend( label(1 "ppp") label( 2 "app" ) label (3 "ppa") label (4 "apa" ) label (5 "aaa") ) 
> bar(1, color(gs8)) bar(2, color(green)) bar(3, color(cyan)) bar(4, color(yellow)) bar(5, color(gs12));

. #delimit cr
delimiter now cr
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\virulence_disagreements.tif", as(tif) width(2550) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\virulence_disagreements.tif written in TIFF format)

. 
. restore

. 
. * ppp = gs8, ppa= cyan, pap = red, paa=blue, apa = yellow, aaa= gs12
. * app = green , aap = doesn't occur
. *************************************************************
. 
. 
. ******************************************************
. noi di _n(5) _dup(80) "=" _n " 2 phenotype predictions compared to gold standard" _n _dup(80) "="





================================================================================
 2 phenotype predictions compared to gold standard
================================================================================

. 
. 
. * in table
. noi di "overall results"
overall results

. noi tab gold valueall

goldstanda |                        valueall
        rd |       aaa        apa        app        ppa        ppp |     Total
-----------+-------------------------------------------------------+----------
         - |    15,648         11          7         83      3,004 |    18,753 
         A |     3,364         10          0         17         81 |     3,472 
        NA |     2,858          1          0         22        452 |     3,333 
         P |        12          2          0         10        619 |       643 
-----------+-------------------------------------------------------+----------
     Total |    21,882         24          7        132      4,156 |    26,201 


. 
. noi di "results by site"
results by site

. noi tab site valueall

              |                        valueall
         site |       aaa        apa        app        ppa        ppp |     Total
--------------+-------------------------------------------------------+----------
          eta |     1,338          1          0          0         40 |     1,379 
          etb |     1,372          1          0          1          5 |     1,379 
          etd |     1,320          1          0          1         57 |     1,379 
         meca |       999          1          0          2        377 |     1,379 
         mecc |     1,362          0          0          0         17 |     1,379 
          pvl |     1,266          3          0          1        109 |     1,379 
          sea |     1,080          1          0          3        295 |     1,379 
          seb |     1,267          1          0          2        109 |     1,379 
          sec |     1,149          1          0          4        225 |     1,379 
          sed |     1,313          0          0          0         66 |     1,379 
          see |     1,375          0          0          0          4 |     1,379 
          seg |       600          6          0         20        753 |     1,379 
          seh |     1,241          2          0          2        134 |     1,379 
          sei |       596          3          6         33        741 |     1,379 
          sej |     1,310          0          0          0         69 |     1,379 
         selr |     1,312          0          0          0         67 |     1,379 
          sep |     1,268          0          1          2        108 |     1,379 
          seu |       595          2          0         57        725 |     1,379 
        tsst1 |     1,119          1          0          4        255 |     1,379 
--------------+-------------------------------------------------------+----------
        Total |    21,882         24          7        132      4,156 |    26,201 


. 
. * reduced table
. noi di "comparision to clear gold value results"
comparision to clear gold value results

. drop if !inlist(gold, "A", "P")
(22,086 observations deleted)

. noi tab gold valueall

goldstanda |                  valueall
        rd |       aaa        apa        ppa        ppp |     Total
-----------+--------------------------------------------+----------
         A |     3,364         10         17         81 |     3,472 
         P |        12          2         10        619 |       643 
-----------+--------------------------------------------+----------
     Total |     3,376         12         27        700 |     4,115 


. gen agree = (valueall=="ppp" & gold=="P")|(valueall=="aaa" & gold=="A")

. summ agree

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       agree |      4,115    .9679222    .1762281          0          1

. noi di r(sum) " out of " r(N) "results agree between all methods and gold standard"
3983 out of 4115results agree between all methods and gold standard

. noi di r(sum)/r(N)*100
96.792224

. 
. * in graph
. preserve

. contract  site  gold valueall

. 
. reshape wide _freq, i(site gold) j(valueall) string
(note: j = aaa apa ppa ppp)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       71   ->      36
Number of variables                   4   ->       6
j variable (4 values)          valueall   ->   (dropped)
xij variables:
                                  _freq   ->   _freqaaa _freqapa ... _freqppp
-----------------------------------------------------------------------------

. rename _freq* *

. 
. 
. gen graphx = site + " " + gold

. drop if !inlist(gold, "A", "P")
(0 observations deleted)

. sort gold site

.  gen num =_n

.  replace num=num+1 if gold=="P"
(17 real changes made)

. labmask num, values(site)

. gen goldlabel = "Gold standard " + gold

. 
. * bar graph of predictions (antibiotics)
. #delimit ;
delimiter now ;
. graph bar (asis) ppp  ppa apa aaa if inlist(golds,"A", "P"),graphregion(color(white))    
> over(site, label(angle(90) labsize(tiny)) )  over(goldlabel, label(labsize(small)) ) stack  
> title("Prediction combinations") subtitle("Results given as Genefinder Mykrobe Typewriter") 
> legend( label(1 "ppp")  label (2 "ppa") label (3 "apa" ) label (4 "aaa") ) 
> bar(1, color(gs8))  bar(2, color(cyan)) bar(3, color(yellow)) bar(4, color(gs12))
> ylabel(0(50)250);

. #delimit cr
delimiter now cr
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\virulence_disagreements_withgold.tif", as(tif) width(2550) r
> eplace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\virulence_disagreements_withgold.tif written in TIFF format)

. 
. restore

. 
. * sensitivity/ specificity
. 
. ******************************************************
. noi di _n(5) _dup(80) "=" _n " 3 find sensitivity and specifity of each method/antibiotic" _n _dup(80) "="





================================================================================
 3 find sensitivity and specifity of each method/antibiotic
================================================================================

. 
. **************************
. * TYPE WRITER
. ****************************
. 
. use viru_panel_all, clear

. 
. assert site!=""

. assert _N==26201

. 
. noi di "restrict to sites with clear gold standard values only"
restrict to sites with clear gold standard values only

. 
. gen clear=inlist(gold, "P", "A")

. summ clear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       clear |     26,201    .1570551    .3638596          0          1

. noi di r(sum) " results are P/A"
4115 results are P/A

. drop if clear!=1
(22,086 observations deleted)

. 
. 
. noi di "Typewriter"
Typewriter

. 
. contract  site  gold valuetype

. rename value predict

. 
. assert predict!=""

. * reshape
. 
. reshape wide _freq, i(site gold) j(predict) string
(note: j = a p)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       52   ->      36
Number of variables                   4   ->       4
j variable (2 values)           predict   ->   (dropped)
xij variables:
                                  _freq   ->   _freqa _freqp
-----------------------------------------------------------------------------

. rename _freq* *

. 
. rename p combop

. rename a comboa

. reshape wide combo*, i(site) j(gold) string
(note: j = A P)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       36   ->      19
Number of variables                   4   ->       5
j variable (2 values)      goldstandard   ->   (dropped)
xij variables:
                                 comboa   ->   comboaA comboaP
                                 combop   ->   combopA combopP
-----------------------------------------------------------------------------

. rename combo* *

. 
. * remember : resistance = postive result
. rename aA TN

. rename pP TP

. rename aP FN 

. *so predicted sensitive but actually resistant
. rename pA FP 

. * predicted resistant but actually sensitive
. 
. for any TN TP FN FP: replace X=0 if X==.

->  replace TN=0 if TN==.
(0 real changes made)

->  replace TP=0 if TP==.
(2 real changes made)

->  replace FN=0 if FN==.
(10 real changes made)

->  replace FP=0 if FP==.
(12 real changes made)

. 
. gen sensitivity = TP/(TP+FN)
(2 missing values generated)

. gen specificity = TN/(TN+FP)

. 
. gen predictPOS = TP+FP

. gen predictNEG = TN +FN

. 
. gen trueNeg= TN +FP

. gen truePos= TP +FN

. 
. gen MajorErrorRate = FN/truePos
(2 missing values generated)

. gen VeryMajorErrorRate = FP/trueNeg

. gen Agreement = (TP+TN)/(trueNeg+truePos)

. 
. * get confidence intervals
. for any lsens usens lspec uspec lme ume lvme uvme:gen X=.

->  gen lsens=.
(19 missing values generated)

->  gen usens=.
(19 missing values generated)

->  gen lspec=.
(19 missing values generated)

->  gen uspec=.
(19 missing values generated)

->  gen lme=.
(19 missing values generated)

->  gen ume=.
(19 missing values generated)

->  gen lvme=.
(19 missing values generated)

->  gen uvme=.
(19 missing values generated)

. local max=_N

. forvalues i=1(1)`max'{
  2. if truePos[`i']>0{
  3. cii prop  truePos[`i'] TP[`i']
  4. replace lsens = r(lb) if _n==`i'
  5. replace usens = r(ub) if _n==`i'
  6. cii prop truePos[`i'] FN[`i']
  7. replace lvme = r(lb) if _n==`i'
  8. replace uvme = r(ub) if _n==`i'
  9. }
 10. else{
 11. noi di site[`i'] " has no positive samples"
 12. }
 13. if trueNeg[`i']>0{
 14. cii prop trueNeg[`i'] TN[`i']
 15. replace lspec = r(lb) if _n==`i'
 16. replace uspec = r(ub) if _n==`i'
 17. cii prop trueNeg[`i'] FP[`i']
 18. replace lme = r(lb) if _n==`i'
 19. replace ume = r(ub) if _n==`i'
 20. }
 21. else{
 22. noi di site[`i'] " has no negative samples"
 23. }
 24. }

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         18           1           0         .814698           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         18           0           0               0     .185302*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        188           1           0        .9805696           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        188           0           0               0    .0194304*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           1           0        .2924018           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           0           0               0    .7075982*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        203           1           0        .9819923           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        203           0           0               0    .0180077*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           1           0        .7529474           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           0           0               0    .2470526*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        193           1           0        .9810681           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        193           0           0               0    .0189319*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        151    .9933775    .0066006        .9636554    .9998323
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        151    .0066225    .0066006        .0001677    .0363446
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .9943503    .0056337        .9689253     .999857
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .0056497    .0056337         .000143    .0310747
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           1           0        .7529474           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           0           0               0    .2470526*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        155           1           0        .9764817           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        155           0           0               0    .0235183*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         95    .9578947    .0206047        .8956916    .9884104
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         95    .0421053    .0206047        .0115896    .1043084
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        239           1           0        .9846839           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        239           0           0               0    .0153161*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         40        .925    .0416458        .7961353    .9842578
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         40        .075    .0416458        .0157422    .2038647
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        165    .9939394    .0060422        .9666966    .9998466
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        165    .0060606    .0060422        .0001534    .0333034
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           1           0        .8389024           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           0           0               0    .1610976*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184           1           0        .9801514           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184           0           0               0    .0198486*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         28    .9642857    .0350707        .8165224    .9990962
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         28    .0357143    .0350707        .0009038    .1834776
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .9943503    .0056337        .9689253     .999857
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .0056497    .0056337         .000143    .0310747
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         16           1           0        .7940928           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         16           0           0               0    .2059072*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        189           1           0        .9806714           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        189           0           0               0    .0193286*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           1           0        .2924018           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           0           0               0    .7075982*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        202           1           0         .981904           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        202           0           0               0     .018096*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         77     .987013    .0129024        .9297529    .9996713
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         77     .012987    .0129024        .0003287    .0702471
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        128           1           0        .9715919           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        128           0           0               0    .0284081*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         26    .9230769    .0522589        .7486971    .9905446
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         26    .0769231    .0522589        .0094554    .2513029
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        179    .9944134     .005571        .9692681    .9998586
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        179    .0055866     .005571        .0001414    .0307319
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         76    .8947368     .035203        .8030833    .9534464
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         76    .1052632     .035203        .0465536    .1969167
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        129           1           0         .971809           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        129           0           0               0     .028191*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         20         .95     .048734        .7512672    .9987349
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         20         .05     .048734        .0012651    .2487328
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           1           0        .9802576           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           0           0               0    .0197424*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)
selr has no positive samples

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .9073171    .0202536        .8590496    .9432732
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .0926829    .0202536        .0567268    .1409504
(1 real change made)
(1 real change made)
sep has no positive samples

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .9463415    .0157386        .9060199    .9729128
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .0536585    .0157386        .0270872    .0939801
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21    .8571429    .0763604         .636576     .969511
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21    .1428571    .0763604         .030489     .363424
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .7445652    .0321501        .6751918    .8058804
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .2554348    .0321501        .1941196    .3248082
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         22           1           0        .8456275           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         22           0           0               0    .1543725*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           1           0        .9802576           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           0           0               0    .0197424*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

. 
. * save values for combining into graphs
. 
. 
. keep site  sens spec lsens usens lspec uspec

. noi list  site  sens spec lsens usens lspec uspec

     +-------------------------------------------------------------------------+
     |  site   sensit~y   specif~y      lsens      usens      lspec      uspec |
     |-------------------------------------------------------------------------|
  1. |   eta          1          1    .814698          1   .9805695          1 |
  2. |   etb          1          1   .2924018          1   .9819923          1 |
  3. |   etd          1          1   .7529474          1   .9810681          1 |
  4. |  meca   .9933775   .9943503   .9636555   .9998323   .9689253   .9998569 |
  5. |  mecc          1          1   .7529474          1   .9764817          1 |
     |-------------------------------------------------------------------------|
  6. |   pvl   .9578947          1   .8956916   .9884104   .9846839          1 |
  7. |   sea       .925   .9939394   .7961352   .9842578   .9666966   .9998466 |
  8. |   seb          1          1   .8389024          1   .9801514          1 |
  9. |   sec   .9642857   .9943503   .8165224   .9990962   .9689253   .9998569 |
 10. |   sed          1          1   .7940928          1   .9806713          1 |
     |-------------------------------------------------------------------------|
 11. |   see          1          1   .2924018          1    .981904          1 |
 12. |   seg    .987013          1   .9297529   .9996713   .9715919          1 |
 13. |   seh   .9230769   .9944134   .7486971   .9905446   .9692681   .9998586 |
 14. |   sei   .8947368          1   .8030833   .9534464    .971809          1 |
 15. |   sej        .95          1   .7512673   .9987349   .9802576          1 |
     |-------------------------------------------------------------------------|
 16. |  selr          .   .9073171          .          .   .8590496   .9432732 |
 17. |   sep          .   .9463415          .          .   .9060199   .9729128 |
 18. |   seu   .8571429   .7445652    .636576    .969511   .6751918   .8058804 |
 19. | tsst1          1          1   .8456275          1   .9802576          1 |
     +-------------------------------------------------------------------------+

. rename * tw_*

. rename tw_site site

. save typewriter, replace
file typewriter.dta saved

. 
. * graph
. use typewriter, clear

. sort site

. gen num =_n 

. labmask num, values(site)

. local max= _N

. 
. #delimit ;
delimiter now ;
. twoway rcap tw_usens tw_lsens num || scatter tw_sens num,  xlabel(1(1)`max', valuelabel angle(90))
> legend(off) title("Typewriter vs. Lab") 
> subtitle("Sensitivity in Virulence prediction");

. #delimit cr
delimiter now cr
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\tw_viru_sens.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\tw_viru_sens.tif written in TIFF format)

. 
. 
. #delimit ;
delimiter now ;
. twoway rcap tw_uspec tw_lspec num || scatter tw_spec num,  xlabel(1(1)`max', valuelabel angle(90))
> legend(off) title("Typewriter vs. Lab") 
> subtitle("Specificity in Virulence prediction");

. #delimit cr
delimiter now cr
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\tw_viru_spec.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\tw_viru_spec.tif written in TIFF format)

. 
. 
. ***************************************************
. * GENEFINDER
. ***************************************************
. use viru_panel_all, clear

. 
. assert site!=""

. assert _N==26201

. 
. noi di "restrict to sites with clear gold standard values only"
restrict to sites with clear gold standard values only

. 
. gen clear=inlist(gold, "A", "P")

. summ clear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       clear |     26,201    .1570551    .3638596          0          1

. noi di r(sum) " results are P/A"
4115 results are P/A

. drop if clear!=1
(22,086 observations deleted)

. 
. 
. noi di "Genefinder"
Genefinder

. 
. contract  site  gold valuegene

. rename value predict

. 
. assert predict!=""

. * reshape
. 
. reshape wide _freq, i(site gold) j(predict) string
(note: j = a p)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       54   ->      36
Number of variables                   4   ->       4
j variable (2 values)           predict   ->   (dropped)
xij variables:
                                  _freq   ->   _freqa _freqp
-----------------------------------------------------------------------------

. rename _freq* *

. 
. rename p combop

. rename a comboa

. reshape wide combo*, i(site) j(gold) string
(note: j = A P)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       36   ->      19
Number of variables                   4   ->       5
j variable (2 values)      goldstandard   ->   (dropped)
xij variables:
                                 comboa   ->   comboaA comboaP
                                 combop   ->   combopA combopP
-----------------------------------------------------------------------------

. rename combo* *

. 
. * remember : resistance = postive result
. rename aA TN

. rename pP TP

. rename aP FN 

. *so predicted sensitive but actually resistant
. rename pA FP 

. * predicted resistant but actually sensitive
. 
. for any TN TP FN FP: replace X=0 if X==.

->  replace TN=0 if TN==.
(0 real changes made)

->  replace TP=0 if TP==.
(2 real changes made)

->  replace FN=0 if FN==.
(12 real changes made)

->  replace FP=0 if FP==.
(8 real changes made)

. 
. gen sensitivity = TP/(TP+FN)
(2 missing values generated)

. gen specificity = TN/(TN+FP)

. 
. gen predictPOS = TP+FP

. gen predictNEG = TN +FN

. 
. gen trueNeg= TN +FP

. gen truePos= TP +FN

. 
. gen MajorErrorRate = FN/truePos
(2 missing values generated)

. gen VeryMajorErrorRate = FP/trueNeg

. gen Agreement = (TP+TN)/(trueNeg+truePos)

. 
. * get confidence intervals
. for any lsens usens lspec uspec lme ume lvme uvme:gen X=.

->  gen lsens=.
(19 missing values generated)

->  gen usens=.
(19 missing values generated)

->  gen lspec=.
(19 missing values generated)

->  gen uspec=.
(19 missing values generated)

->  gen lme=.
(19 missing values generated)

->  gen ume=.
(19 missing values generated)

->  gen lvme=.
(19 missing values generated)

->  gen uvme=.
(19 missing values generated)

. local max=_N

. forvalues i=1(1)`max'{
  2. if truePos[`i']>0{
  3. cii prop  truePos[`i'] TP[`i']
  4. replace lsens = r(lb) if _n==`i'
  5. replace usens = r(ub) if _n==`i'
  6. cii prop truePos[`i'] FN[`i']
  7. replace lvme = r(lb) if _n==`i'
  8. replace uvme = r(ub) if _n==`i'
  9. }
 10. else{
 11. noi di site[`i'] " has no positive samples"
 12. }
 13. if trueNeg[`i']>0{
 14. cii prop trueNeg[`i'] TN[`i']
 15. replace lspec = r(lb) if _n==`i'
 16. replace uspec = r(ub) if _n==`i'
 17. cii prop trueNeg[`i'] FP[`i']
 18. replace lme = r(lb) if _n==`i'
 19. replace ume = r(ub) if _n==`i'
 20. }
 21. else{
 22. noi di site[`i'] " has no negative samples"
 23. }
 24. }

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         18           1           0         .814698           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         18           0           0               0     .185302*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        188           1           0        .9805696           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        188           0           0               0    .0194304*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           1           0        .2924018           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           0           0               0    .7075982*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        203    .9950739     .004914        .9728605    .9998753
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        203    .0049261     .004914        .0001247    .0271395
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           1           0        .7529474           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           0           0               0    .2470526*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        193           1           0        .9810681           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        193           0           0               0    .0189319*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        151           1           0        .9758663           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        151           0           0               0    .0241337*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .9943503    .0056337        .9689253     .999857
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .0056497    .0056337         .000143    .0310747
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           1           0        .7529474           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           0           0               0    .2470526*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        155           1           0        .9764817           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        155           0           0               0    .0235183*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         95    .9578947    .0206047        .8956916    .9884104
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         95    .0421053    .0206047        .0115896    .1043084
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        239           1           0        .9846839           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        239           0           0               0    .0153161*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         40        .925    .0416458        .7961353    .9842578
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         40        .075    .0416458        .0157422    .2038647
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        165    .9878788    .0085189        .9569018    .9985287
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        165    .0121212    .0085189        .0014713    .0430982
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           1           0        .8389024           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           0           0               0    .1610976*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184           1           0        .9801514           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184           0           0               0    .0198486*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         28    .9642857    .0350707        .8165224    .9990962
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         28    .0357143    .0350707        .0009038    .1834776
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .9887006    .0079446        .9597806    .9986286
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .0112994    .0079446        .0013714    .0402194
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         16           1           0        .7940928           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         16           0           0               0    .2059072*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        189           1           0        .9806714           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        189           0           0               0    .0193286*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           1           0        .2924018           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           0           0               0    .7075982*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        202           1           0         .981904           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        202           0           0               0     .018096*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         77     .987013    .0129024        .9297529    .9996713
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         77     .012987    .0129024        .0003287    .0702471
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        128    .9921875    .0077819         .957241    .9998022
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        128    .0078125    .0077819        .0001978     .042759
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         26    .9230769    .0522589        .7486971    .9905446
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         26    .0769231    .0522589        .0094554    .2513029
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        179    .9944134     .005571        .9692681    .9998586
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        179    .0055866     .005571        .0001414    .0307319
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         76    .9736842    .0183616        .9081505     .996797
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         76    .0263158    .0183616         .003203    .0918495
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        129    .9922481    .0077218        .9575666    .9998038
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        129    .0077519    .0077218        .0001962    .0424334
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         20         .95     .048734        .7512672    .9987349
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         20         .05     .048734        .0012651    .2487328
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           1           0        .9802576           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           0           0               0    .0197424*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)
selr has no positive samples

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .9073171    .0202536        .8590496    .9432732
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .0926829    .0202536        .0567268    .1409504
(1 real change made)
(1 real change made)
sep has no positive samples

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .9463415    .0157386        .9060199    .9729128
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .0536585    .0157386        .0270872    .0939801
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           1           0        .8389024           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           0           0               0    .1610976*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .6847826    .0342509         .612345    .7511508
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .3152174    .0342509        .2488492     .387655
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         22           1           0        .8456275           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         22           0           0               0    .1543725*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185    .9945946    .0053908        .9702525    .9998632
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185    .0054054    .0053908        .0001368    .0297475
(1 real change made)
(1 real change made)

. 
. * save values for combining into graphs
. 
. 
. keep site  sens spec lsens usens lspec uspec

. noi list  site  sens spec lsens usens lspec uspec

     +-------------------------------------------------------------------------+
     |  site   sensit~y   specif~y      lsens      usens      lspec      uspec |
     |-------------------------------------------------------------------------|
  1. |   eta          1          1    .814698          1   .9805695          1 |
  2. |   etb          1   .9950739   .2924018          1   .9728606   .9998753 |
  3. |   etd          1          1   .7529474          1   .9810681          1 |
  4. |  meca          1   .9943503   .9758663          1   .9689253   .9998569 |
  5. |  mecc          1          1   .7529474          1   .9764817          1 |
     |-------------------------------------------------------------------------|
  6. |   pvl   .9578947          1   .8956916   .9884104   .9846839          1 |
  7. |   sea       .925   .9878788   .7961352   .9842578   .9569018   .9985287 |
  8. |   seb          1          1   .8389024          1   .9801514          1 |
  9. |   sec   .9642857   .9887006   .8165224   .9990962   .9597806   .9986286 |
 10. |   sed          1          1   .7940928          1   .9806713          1 |
     |-------------------------------------------------------------------------|
 11. |   see          1          1   .2924018          1    .981904          1 |
 12. |   seg    .987013   .9921875   .9297529   .9996713   .9572409   .9998022 |
 13. |   seh   .9230769   .9944134   .7486971   .9905446   .9692681   .9998586 |
 14. |   sei   .9736842   .9922481   .9081505    .996797   .9575666   .9998038 |
 15. |   sej        .95          1   .7512673   .9987349   .9802576          1 |
     |-------------------------------------------------------------------------|
 16. |  selr          .   .9073171          .          .   .8590496   .9432732 |
 17. |   sep          .   .9463415          .          .   .9060199   .9729128 |
 18. |   seu          1   .6847826   .8389024          1    .612345   .7511507 |
 19. | tsst1          1   .9945946   .8456275          1   .9702525   .9998631 |
     +-------------------------------------------------------------------------+

. rename * gf_*

. rename gf_site site

. save genefinder, replace
file genefinder.dta saved

. 
. 
. * graph
. use genefinder, clear

. sort site

. gen num =_n 

. labmask num, values(site)

. local max= _N

. 
. #delimit ;
delimiter now ;
. twoway rcap gf_usens gf_lsens num || scatter gf_sens num,  xlabel(1(1)`max', valuelabel angle(90))
> legend(off) title("Genefinder vs. Lab") 
> subtitle("Sensitivity in Phenotype prediction");

. #delimit cr
delimiter now cr
. 
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\gf_viru_sens.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\gf_viru_sens.tif written in TIFF format)

. 
. 
. #delimit ;
delimiter now ;
. twoway rcap gf_uspec gf_lspec num || scatter gf_spec num,  xlabel(1(1)`max', valuelabel angle(90))
> legend(off) title("Genefinder vs. Lab") 
> subtitle("Specificity in Phenotype prediction");

. #delimit cr
delimiter now cr
. 
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\gf_viru_spec.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\gf_viru_spec.tif written in TIFF format)

. 
. 
. 
. ***************************************************
. * MYKROBE
. ***************************************************
. use viru_panel_all, clear

. 
. assert site!=""

. assert _N==26201

. 
. noi di "restrict to sites with clear gold standard values only"
restrict to sites with clear gold standard values only

. 
. gen clear=inlist(gold, "A", "P")

. summ clear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       clear |     26,201    .1570551    .3638596          0          1

. noi di r(sum) " results are P/A"
4115 results are P/A

. drop if clear!=1
(22,086 observations deleted)

. 
. 
. noi di "Mykrobe"
Mykrobe

. 
. contract  site  gold valuezam

. rename value predict

. 
. assert predict!=""

. * reshape
. 
. reshape wide _freq, i(site gold) j(predict) string
(note: j = a p)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       58   ->      36
Number of variables                   4   ->       4
j variable (2 values)           predict   ->   (dropped)
xij variables:
                                  _freq   ->   _freqa _freqp
-----------------------------------------------------------------------------

. rename _freq* *

. 
. rename p combop

. rename a comboa

. reshape wide combo*, i(site) j(gold) string
(note: j = A P)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                       36   ->      19
Number of variables                   4   ->       5
j variable (2 values)      goldstandard   ->   (dropped)
xij variables:
                                 comboa   ->   comboaA comboaP
                                 combop   ->   combopA combopP
-----------------------------------------------------------------------------

. rename combo* *

. 
. * remember : resistance = postive result
. rename aA TN

. rename pP TP

. rename aP FN 

. *so predicted sensitive but actually resistant
. rename pA FP 

. * predicted resistant but actually sensitive
. 
. for any TN TP FN FP: replace X=0 if X==.

->  replace TN=0 if TN==.
(0 real changes made)

->  replace TP=0 if TP==.
(2 real changes made)

->  replace FN=0 if FN==.
(12 real changes made)

->  replace FP=0 if FP==.
(4 real changes made)

. 
. gen sensitivity = TP/(TP+FN)
(2 missing values generated)

. gen specificity = TN/(TN+FP)

. 
. gen predictPOS = TP+FP

. gen predictNEG = TN +FN

. 
. gen trueNeg= TN +FP

. gen truePos= TP +FN

. 
. gen MajorErrorRate = FN/truePos
(2 missing values generated)

. gen VeryMajorErrorRate = FP/trueNeg

. gen Agreement = (TP+TN)/(trueNeg+truePos)

. 
. * get confidence intervals
. for any lsens usens lspec uspec lme ume lvme uvme:gen X=.

->  gen lsens=.
(19 missing values generated)

->  gen usens=.
(19 missing values generated)

->  gen lspec=.
(19 missing values generated)

->  gen uspec=.
(19 missing values generated)

->  gen lme=.
(19 missing values generated)

->  gen ume=.
(19 missing values generated)

->  gen lvme=.
(19 missing values generated)

->  gen uvme=.
(19 missing values generated)

. local max=_N

. forvalues i=1(1)`max'{
  2. if truePos[`i']>0{
  3. cii prop  truePos[`i'] TP[`i']
  4. replace lsens = r(lb) if _n==`i'
  5. replace usens = r(ub) if _n==`i'
  6. cii prop truePos[`i'] FN[`i']
  7. replace lvme = r(lb) if _n==`i'
  8. replace uvme = r(ub) if _n==`i'
  9. }
 10. else{
 11. noi di site[`i'] " has no positive samples"
 12. }
 13. if trueNeg[`i']>0{
 14. cii prop trueNeg[`i'] TN[`i']
 15. replace lspec = r(lb) if _n==`i'
 16. replace uspec = r(ub) if _n==`i'
 17. cii prop trueNeg[`i'] FP[`i']
 18. replace lme = r(lb) if _n==`i'
 19. replace ume = r(ub) if _n==`i'
 20. }
 21. else{
 22. noi di site[`i'] " has no negative samples"
 23. }
 24. }

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         18           1           0         .814698           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         18           0           0               0     .185302*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        188    .9946809     .005305        .9707214    .9998653
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        188    .0053191     .005305        .0001347    .0292786
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           1           0        .2924018           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           0           0               0    .7075982*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        203    .9950739     .004914        .9728605    .9998753
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        203    .0049261     .004914        .0001247    .0271395
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           1           0        .7529474           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           0           0               0    .2470526*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        193    .9948187    .0051679         .971471    .9998688
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        193    .0051813    .0051679        .0001312     .028529
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        151           1           0        .9758663           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        151           0           0               0    .0241337*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .9887006    .0079446        .9597806    .9986286
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .0112994    .0079446        .0013714    .0402194
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           1           0        .7529474           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         13           0           0               0    .2470526*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        155           1           0        .9764817           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        155           0           0               0    .0235183*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         95    .9684211    .0179419        .9104775    .9934397
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         95    .0315789    .0179419        .0065603    .0895225
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        239    .9916318    .0058924        .9700998     .998985
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        239    .0083682    .0058924         .001015    .0299002
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         40        .925    .0416458        .7961353    .9842578
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         40        .075    .0416458        .0157422    .2038647
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        165    .9878788    .0085189        .9569018    .9985287
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        165    .0121212    .0085189        .0014713    .0430982
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           1           0        .8389024           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           0           0               0    .1610976*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .9945652      .00542        .9700928    .9998624
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .0054348      .00542        .0001376    .0299072
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         28    .9642857    .0350707        .8165224    .9990962
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         28    .0357143    .0350707        .0009038    .1834776
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .9830508    .0097023        .9512687    .9964909
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        177    .0169492    .0097023        .0035091    .0487313
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         16           1           0        .7940928           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         16           0           0               0    .2059072*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        189           1           0        .9806714           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        189           0           0               0    .0193286*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           1           0        .2924018           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |          3           0           0               0    .7075982*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        202           1           0         .981904           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        202           0           0               0     .018096*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         77     .987013    .0129024        .9297529    .9996713
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         77     .012987    .0129024        .0003287    .0702471
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        128     .984375    .0109619        .9446974    .9981021
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        128     .015625    .0109619        .0018979    .0553026
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         26    .9230769    .0522589        .7486971    .9905446
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         26    .0769231    .0522589        .0094554    .2513029
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        179    .9888268    .0078564        .9602234     .998644
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        179    .0111732    .0078564         .001356    .0397766
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         76    .9868421     .013071        .9288563    .9996669
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         76    .0131579     .013071        .0003331    .0711437
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        129    .9922481    .0077218        .9575666    .9998038
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        129    .0077519    .0077218        .0001962    .0424334
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         20         .95     .048734        .7512672    .9987349
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         20         .05     .048734        .0012651    .2487328
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           1           0        .9802576           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185           0           0               0    .0197424*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)
selr has no positive samples

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .9073171    .0202536        .8590496    .9432732
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .0926829    .0202536        .0567268    .1409504
(1 real change made)
(1 real change made)
sep has no positive samples

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .9463415    .0157386        .9060199    .9729128
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        205    .0536585    .0157386        .0270872    .0939801
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           1           0        .8389024           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         21           0           0               0    .1610976*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .6847826    .0342509         .612345    .7511508
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        184    .3152174    .0342509        .2488492     .387655
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         22           1           0        .8456275           1*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |         22           0           0               0    .1543725*

(*) one-sided, 97.5% confidence interval
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185    .9891892     .007603        .9614952    .9986881
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        185    .0108108     .007603        .0013119    .0385048
(1 real change made)
(1 real change made)

. 
. * save values for combining into graphs
. 
. 
. keep site  sens spec lsens usens lspec uspec

. noi list  site  sens spec lsens usens lspec uspec

     +-------------------------------------------------------------------------+
     |  site   sensit~y   specif~y      lsens      usens      lspec      uspec |
     |-------------------------------------------------------------------------|
  1. |   eta          1   .9946808    .814698          1   .9707214   .9998654 |
  2. |   etb          1   .9950739   .2924018          1   .9728606   .9998753 |
  3. |   etd          1   .9948186   .7529474          1    .971471   .9998688 |
  4. |  meca          1   .9887006   .9758663          1   .9597806   .9986286 |
  5. |  mecc          1          1   .7529474          1   .9764817          1 |
     |-------------------------------------------------------------------------|
  6. |   pvl    .968421   .9916318   .9104775   .9934397   .9700998   .9989849 |
  7. |   sea       .925   .9878788   .7961352   .9842578   .9569018   .9985287 |
  8. |   seb          1   .9945652   .8389024          1   .9700928   .9998624 |
  9. |   sec   .9642857   .9830508   .8165224   .9990962   .9512687    .996491 |
 10. |   sed          1          1   .7940928          1   .9806713          1 |
     |-------------------------------------------------------------------------|
 11. |   see          1          1   .2924018          1    .981904          1 |
 12. |   seg    .987013    .984375   .9297529   .9996713   .9446974   .9981021 |
 13. |   seh   .9230769   .9888268   .7486971   .9905446   .9602234    .998644 |
 14. |   sei   .9868421   .9922481   .9288563   .9996669   .9575666   .9998038 |
 15. |   sej        .95          1   .7512673   .9987349   .9802576          1 |
     |-------------------------------------------------------------------------|
 16. |  selr          .   .9073171          .          .   .8590496   .9432732 |
 17. |   sep          .   .9463415          .          .   .9060199   .9729128 |
 18. |   seu          1   .6847826   .8389024          1    .612345   .7511507 |
 19. | tsst1          1   .9891892   .8456275          1   .9614952    .998688 |
     +-------------------------------------------------------------------------+

. rename * z_*

. rename z_site site

. save mykrobe, replace
file mykrobe.dta saved

. 
. 
. * graph
. use mykrobe, clear

. sort site

. gen num =_n 

. labmask num, values(site)

. local max= _N

. 
. #delimit ;
delimiter now ;
. twoway rcap z_usens z_lsens num || scatter z_sens num,  xlabel(1(1)`max', valuelabel angle(90))
> legend(off) title("Mykrobe vs. Lab") 
> subtitle("Sensitivity in Phenotype prediction");

. #delimit cr
delimiter now cr
. 
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\z_viru_sens.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\z_viru_sens.tif written in TIFF format)

. 
. 
. #delimit ;
delimiter now ;
. twoway rcap z_uspec z_lspec num || scatter z_spec num,  xlabel(1(1)`max', valuelabel angle(90))
> legend(off) title("Mykrobe vs. Lab") 
> subtitle("Specificity in Phenotype prediction");

. #delimit cr
delimiter now cr
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\z_viru_spec.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\z_viru_spec.tif written in TIFF format)

. 
. 
. ***************************
. * COMBINED
. ***************************
. 
. * merge the three sets
. use typewriter, clear

.  merge 1:1 site using genefinder, update

    Result                           # of obs.
    -----------------------------------------
    not matched                             0

    matched                                19
        not updated                        19  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

.  assert _merge==3

.  drop _merge

.  merge 1:1 site using mykrobe, update 

    Result                           # of obs.
    -----------------------------------------
    not matched                             0

    matched                                19
        not updated                        19  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

.  assert _merge==3

.  drop _merge

.  
.  * reshape to enable graph
. reshape long tw_ gf_ z_, i(site) j(new) string
(note: j = lsens lspec sensitivity specificity usens uspec)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                       19   ->     114
Number of variables                  19   ->       5
j variable (6 values)                     ->   new
xij variables:
         tw_lsens tw_lspec ... tw_uspec   ->   tw_
         gf_lsens gf_lspec ... gf_uspec   ->   gf_
            z_lsens z_lspec ... z_uspec   ->   z_
-----------------------------------------------------------------------------

. rename tw_ meth_tw

. rename gf_ meth_gf

. rename z_ meth_z

. 
. reshape long meth_, i(site new) j(method) string
(note: j = gf tw z)

Data                               wide   ->   long
-----------------------------------------------------------------------------
Number of obs.                      114   ->     342
Number of variables                   5   ->       4
j variable (3 values)                     ->   method
xij variables:
                 meth_gf meth_tw meth_z   ->   meth_
-----------------------------------------------------------------------------

. rename meth_ value

. 
. reshape wide value, i(site method) j(new) string
(note: j = lsens lspec sensitivity specificity usens uspec)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                      342   ->      57
Number of variables                   4   ->       8
j variable (6 values)               new   ->   (dropped)
xij variables:
                                  value   ->   valuelsens valuelspec ... valueuspec
-----------------------------------------------------------------------------

. rename value* *

. 
. order site method sens lsens usens spec lspec uspec

. 
. 
. * sneaky creating gaps on graphs
. expand 3 if method =="gf", gen(dups)
(38 observations created)

. replace method ="blank" if dups==1
variable method was str2 now str5
(38 real changes made)

. replace sens=. if method=="blank"
(34 real changes made, 34 to missing)

. replace lsens=. if method=="blank"
(34 real changes made, 34 to missing)

. replace usens=. if method=="blank"
(34 real changes made, 34 to missing)

. replace uspec=. if method=="blank"
(38 real changes made, 38 to missing)

. replace lspec=. if method=="blank"
(38 real changes made, 38 to missing)

. replace spec=. if method=="blank"
(38 real changes made, 38 to missing)

. 
. * order bits
. encode(method), gen(order)

. sort site order

. gen newcount = _n

. local max =_N

. replace site = "fusidic acid" if strpos(site, "fus")
(0 real changes made)

. labmask newcount, values(site)

. 
. #delimit ;
delimiter now ;
. twoway rcap usens lsens newcount, ylabel(,format(%3.2f)) xlabel(4(5)94, valuelabel angle(90))
> || scatter  sens newcount if method=="gf", mcolor(orange) msize(small)
> ||  scatter  sensitivity newcount if method =="tw", mcolor(red)  msize(small)
> || scatter  sens newcount if method=="z", mcolor(blue) msize(small)
> legend(order(2 3 4) lab(2 "Genefinder") lab(3 "Typewriter") lab(4 "Mykrobe"))
> subtitle("Sensitivity in Phenotype prediction") graphregion(fcolor(white));

. #delimit cr
delimiter now cr
. 
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\all_viru_sens.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\all_viru_sens.tif written in TIFF format)

. 
. #delimit ;
delimiter now ;
. twoway rcap uspec lspec newcount, ylabel(,format(%3.2f))
> || scatter  spec newcount if method=="gf", mcolor(orange) msize(small)
> || scatter  spec newcount if method =="tw", mcolor(red) msize(small)
> || scatter  spec newcount if method=="z", mcolor(blue) msize(small)
> xlabel(4(5)94, valuelabel angle(90))
> legend(order(2 3 4) lab(2 "Genefinder") lab(3 "Typewriter") lab(4 "Mykrobe") )
> subtitle("Specificity in Phenotype prediction") graphregion(fcolor(white));

. #delimit cr
delimiter now cr
. 
. graph export "E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\all_viru_spec.tif", as(tif) replace
(file E:\users\amy.mason\Pipeline_27_07_2016\Graphs_Outputs\all_viru_spec.tif written in TIFF format)

. 
. **************************************************
. * OVERALL
. **************************************************
. noi di "all methods"
all methods

. tempfile temp

.         use viru_panel_all, clear

.         assert site!=""

.         assert _N==26201

. * restrict to clear goldstandard values
.         gen clear=inlist(gold, "A", "P")

.         summ clear

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       clear |     26,201    .1570551    .3638596          0          1

.         noi di r(sum) " results are A/P"
4115 results are A/P

.         drop if clear!=1
(22,086 observations deleted)

.         contract  gold valuegene

.         rename value predict

.         assert predict!=""

. * reshape
.         reshape wide _freq, i( gold) j(predict) string
(note: j = a p)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                        4   ->       2
Number of variables                   3   ->       3
j variable (2 values)           predict   ->   (dropped)
xij variables:
                                  _freq   ->   _freqa _freqp
-----------------------------------------------------------------------------

.         rename _freq* *

.         rename p combop

.         rename a comboa

.         gen method = "valuegene"

.         reshape wide combo*, i(method) j(gold) string
(note: j = A P)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                        2   ->       1
Number of variables                   4   ->       5
j variable (2 values)      goldstandard   ->   (dropped)
xij variables:
                                 comboa   ->   comboaA comboaP
                                 combop   ->   combopA combopP
-----------------------------------------------------------------------------

.         rename combo* *

. 
. * remember : resistance = postive result
. rename aA TN

. rename pP TP

. rename aP FN 

. *so predicted sensitive but actually resistant
. rename pA FP 

. * predicted resistant but actually sensitive
. save temp, replace
file temp.dta saved

.         
. foreach k in valuetype valuez{
  2.         use viru_panel_all, clear
  3.         assert site!=""
  4.         assert _N==26201
  5. * restrict to clear goldstandard values
.         gen clear=inlist(gold, "A", "P")
  6.         summ clear
  7.         noi di r(sum) " results are A/P"
  8.         drop if clear!=1
  9.         contract  gold `k'
 10.         rename value predict
 11.         assert predict!=""
 12. * reshape
.         reshape wide _freq, i( gold) j(predict) string
 13.         rename _freq* *
 14.         rename p combop
 15.         rename a comboa
 16.         gen method = "`k'"
 17.         reshape wide combo*, i(method) j(gold) string
 18.         rename combo* *
 19. 
.         * remember : resistance = postive result
.         rename aA TN
 20.         rename pP TP
 21.         rename aP FN 
 22.         *so predicted sensitive but actually resistant
.         rename pA FP 
 23.         * predicted resistant but actually sensitive
.         append using temp
 24.         save temp, replace
 25. }

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       clear |     26,201    .1570551    .3638596          0          1
4115 results are A/P
(22,086 observations deleted)
(note: j = a p)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                        4   ->       2
Number of variables                   3   ->       3
j variable (2 values)           predict   ->   (dropped)
xij variables:
                                  _freq   ->   _freqa _freqp
-----------------------------------------------------------------------------
(note: j = A P)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                        2   ->       1
Number of variables                   4   ->       5
j variable (2 values)      goldstandard   ->   (dropped)
xij variables:
                                 comboa   ->   comboaA comboaP
                                 combop   ->   combopA combopP
-----------------------------------------------------------------------------
file temp.dta saved

    Variable |        Obs        Mean    Std. Dev.       Min        Max
-------------+---------------------------------------------------------
       clear |     26,201    .1570551    .3638596          0          1
4115 results are A/P
(22,086 observations deleted)
(note: j = a p)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                        4   ->       2
Number of variables                   3   ->       3
j variable (2 values)           predict   ->   (dropped)
xij variables:
                                  _freq   ->   _freqa _freqp
-----------------------------------------------------------------------------
(note: j = A P)

Data                               long   ->   wide
-----------------------------------------------------------------------------
Number of obs.                        2   ->       1
Number of variables                   4   ->       5
j variable (2 values)      goldstandard   ->   (dropped)
xij variables:
                                 comboa   ->   comboaA comboaP
                                 combop   ->   combopA combopP
-----------------------------------------------------------------------------
(note: variable method was str6, now str9 to accommodate using data's values)
file temp.dta saved

. 
.         for any TN TP FN FP: replace X=0 if X==.

->  replace TN=0 if TN==.
(0 real changes made)

->  replace TP=0 if TP==.
(0 real changes made)

->  replace FN=0 if FN==.
(0 real changes made)

->  replace FP=0 if FP==.
(0 real changes made)

. 
.         gen sensitivity = TP/(TP+FN)

.         gen specificity = TN/(TN+FP)

. 
.         gen predictPOS = TP+FP

.         gen predictNEG = TN +FN

. 
.         gen trueNeg= TN +FP

.         gen truePos= TP +FN

. 
.         gen MajorErrorRate = FN/truePos

.         gen VeryMajorErrorRate = FP/trueNeg

.         gen Agreement = (TP+TN)/(trueNeg+truePos)

. 
.         * get confidence intervals
.         for any lsens usens lspec uspec lme ume lvme uvme:gen X=.

->  gen lsens=.
(3 missing values generated)

->  gen usens=.
(3 missing values generated)

->  gen lspec=.
(3 missing values generated)

->  gen uspec=.
(3 missing values generated)

->  gen lme=.
(3 missing values generated)

->  gen ume=.
(3 missing values generated)

->  gen lvme=.
(3 missing values generated)

->  gen uvme=.
(3 missing values generated)

.         local max=_N

.         forvalues i=1(1)`max'{
  2.         if truePos[`i']>0{
  3.         cii prop  truePos[`i'] TP[`i']
  4.         replace lsens = r(lb) if _n==`i'
  5.         replace usens = r(ub) if _n==`i'
  6.         cii prop truePos[`i'] FN[`i']
  7.         replace lvme = r(lb) if _n==`i'
  8.         replace uvme = r(ub) if _n==`i'
  9.         }
 10.         else{
 11.         noi di site[`i'] " has no positive samples"
 12.         }
 13.         if trueNeg[`i']>0{
 14.         cii prop trueNeg[`i'] TN[`i']
 15.         replace lspec = r(lb) if _n==`i'
 16.         replace uspec = r(ub) if _n==`i'
 17.         cii prop trueNeg[`i'] FP[`i']
 18.         replace lme = r(lb) if _n==`i'
 19.         replace ume = r(ub) if _n==`i'
 20.         }
 21.         else{
 22.         noi di site[`i'] " has no negative samples"
 23.         }
 24.         }

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        643    .9813375    .0053369        .9676274    .9903205
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        643    .0186625    .0053369        .0096795    .0323726
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |      3,472     .968894    .0029463        .9625663    .9744148
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |      3,472     .031106    .0029463        .0255852    .0374337
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        643     .962675    .0074754        .9449704    .9759414
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        643     .037325    .0074754        .0240586    .0550296
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |      3,472    .9766705    .0025618         .971086    .9814309
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |      3,472    .0233295    .0025618        .0185691     .028914
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        643    .9782271    .0057554        .9637383    .9880466
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |        643    .0217729    .0057554        .0119534    .0362617
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |      3,472    .9717742    .0028107        .9657085    .9770269
(1 real change made)
(1 real change made)

                                                         -- Binomial Exact --
    Variable |        Obs  Proportion    Std. Err.       [95% Conf. Interval]
-------------+---------------------------------------------------------------
             |      3,472    .0282258    .0028107        .0229731    .0342915
(1 real change made)
(1 real change made)

. 
. * save values for combining for table
. noi list method sens lsens usens spec lspec uspec

     +-----------------------------------------------------------------------------+
     |    method   sensit~y      lsens      usens   specif~y      lspec      uspec |
     |-----------------------------------------------------------------------------|
  1. |    valuez   .9813375   .9676275   .9903206    .968894   .9625663   .9744148 |
  2. | valuetype    .962675   .9449704   .9759414   .9766705    .971086   .9814309 |
  3. | valuegene   .9782271   .9637383   .9880466   .9717742   .9657084   .9770269 |
     +-----------------------------------------------------------------------------+

. 
end of do-file

. 
. use anti_panel_all, clear

. 
. 
. 
. keep if valueall=="rsr" | valueall == "srs"
(16,299 observations deleted)

. 
. noi di _N "sample- antibiotic predictions where mykrobe disgrees with typewriter and genefinder"
249sample- antibiotic predictions where mykrobe disgrees with typewriter and genefinder

. 
. 
. 
. noi bysort valuezam: tab site gold 

----------------------------------------------------------------------------------------------------------------------------------
-> valuezam = r

              |                goldstandard
         site |         -         NA          R          S |     Total
--------------+--------------------------------------------+----------
  clindamycin |         7          1          0          2 |        10 
 erythromycin |         0          0          0          8 |         8 
  fusidicacid |         0          0          2          1 |         3 
   gentamicin |         0          0          1          1 |         2 
   penicillin |         0          0          0          1 |         1 
   rifampicin |         0          0          0          1 |         1 
 tetracycline |         0          0          0          5 |         5 
 trimethoprim |         0          1          0          0 |         1 
--------------+--------------------------------------------+----------
        Total |         7          2          3         19 |        31 


----------------------------------------------------------------------------------------------------------------------------------
-> valuezam = s

              |                goldstandard
         site |         -         NA          R          S |     Total
--------------+--------------------------------------------+----------
ciprofloxacin |         0          0          7          0 |         7 
  fusidicacid |         0          0         51          4 |        55 
   penicillin |         0          0         97          3 |       100 
   rifampicin |         0          0         17          0 |        17 
 trimethoprim |        17         12          9          1 |        39 
--------------+--------------------------------------------+----------
        Total |        17         12        181          8 |       218 



. 
. noi tab set

        set |      Freq.     Percent        Cum.
------------+-----------------------------------
 Collindale |         79       31.73       31.73
  Oxford491 |         70       28.11       59.84
  Oxford501 |        100       40.16      100.00
------------+-----------------------------------
      Total |        249      100.00

. 
.  export excel using "E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_disagreements.xls", replace firstrow(variables
> )
file E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_disagreements.xls saved

. preserve
already preserved
r(621);

. restore

. use "E:\users\amy.mason\Pipeline - OLD\Amy_work\pipeline_data_z.dta", clear

. cd E:\users\amy.mason\Pipeline_27_07_2016\Datasets
E:\users\amy.mason\Pipeline_27_07_2016\Datasets

. save mykrobe_old
file mykrobe_old.dta saved

. keep sample site value

. save mykrobe_old
file mykrobe_old.dta already exists
r(602);

. save mykrobe_old, replace
file mykrobe_old.dta saved

. 
. use anti_panel_all, clear

. 
. 
. 
. keep if valueall=="rsr" | valueall == "srs"
(16,299 observations deleted)

. 
. noi di _N "sample- antibiotic predictions where mykrobe disgrees with typewriter and genefinder"
249sample- antibiotic predictions where mykrobe disgrees with typewriter and genefinder

. 
. 
. 
. noi bysort valuezam: tab site gold 

----------------------------------------------------------------------------------------------------------------------------------
-> valuezam = r

              |                goldstandard
         site |         -         NA          R          S |     Total
--------------+--------------------------------------------+----------
  clindamycin |         7          1          0          2 |        10 
 erythromycin |         0          0          0          8 |         8 
  fusidicacid |         0          0          2          1 |         3 
   gentamicin |         0          0          1          1 |         2 
   penicillin |         0          0          0          1 |         1 
   rifampicin |         0          0          0          1 |         1 
 tetracycline |         0          0          0          5 |         5 
 trimethoprim |         0          1          0          0 |         1 
--------------+--------------------------------------------+----------
        Total |         7          2          3         19 |        31 


----------------------------------------------------------------------------------------------------------------------------------
-> valuezam = s

              |                goldstandard
         site |         -         NA          R          S |     Total
--------------+--------------------------------------------+----------
ciprofloxacin |         0          0          7          0 |         7 
  fusidicacid |         0          0         51          4 |        55 
   penicillin |         0          0         97          3 |       100 
   rifampicin |         0          0         17          0 |        17 
 trimethoprim |        17         12          9          1 |        39 
--------------+--------------------------------------------+----------
        Total |        17         12        181          8 |       218 



. 
. noi tab set

        set |      Freq.     Percent        Cum.
------------+-----------------------------------
 Collindale |         79       31.73       31.73
  Oxford491 |         70       28.11       59.84
  Oxford501 |        100       40.16      100.00
------------+-----------------------------------
      Total |        249      100.00

. 
.  export excel using "E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_disagreements.xls", replace firstrow(variables
> )
file E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_disagreements.xls saved

. merge 1:1 sample site using mykrobe_old, update
variable _merge already defined
r(110);

. drop _merge

. merge 1:1 sample site using mykrobe_old, update

    Result                           # of obs.
    -----------------------------------------
    not matched                       123,126
        from master                       249  (_merge==1)
        from using                    122,877  (_merge==2)

    matched                                 0
        not updated                         0  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. 
. use pipeline_clean_all_values_wide, clear

. 
.  keep if ValueAll=="APA" | ValueAll=="PAP"
(116,441 observations deleted)

. 
. 
. 
.   export excel using "E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_site_disagreements.xls", replace firstrow(var
> iables)
file E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_site_disagreements.xls saved

. merge 1:1 sample site using mykrobe_old, update

    Result                           # of obs.
    -----------------------------------------
    not matched                       123,593
        from master                       745  (_merge==1)
        from using                    122,848  (_merge==2)

    matched                                29
        not updated                        29  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. tab site if _merge==2

          site |      Freq.     Percent        Cum.
---------------+-----------------------------------
          IsaB |      1,429        1.16        1.16
      aacAaphD |      1,429        1.16        2.33
    aadDaph4Ia |      1,429        1.16        3.49
    aadEant6Ia |      1,429        1.16        4.65
        ant9Ia |      1,429        1.16        5.82
        ant9Ib |      1,429        1.16        6.98
        aph2Ic |      1,429        1.16        8.14
  aphA3aph3III |      1,429        1.16        9.31
          arcA |      1,428        1.16       10.47
          arcB |      1,429        1.16       11.63
          arcC |      1,429        1.16       12.79
          arcD |      1,427        1.16       13.96
          blaZ |      1,429        1.16       15.12
           cat |      1,429        1.16       16.28
          ccrA |      1,428        1.16       17.45
          ccrB |      1,429        1.16       18.61
         ccrCa |      1,429        1.16       19.77
         ccrCb |      1,428        1.16       20.93
         ccrCc |      1,429        1.16       22.10
           cfr |      1,429        1.16       23.26
           chp |      1,428        1.16       24.42
          dfrA |      1,429        1.16       25.59
          dfrB |      1,429        1.16       26.75
          dfrC |      1,429        1.16       27.91
          dfrD |      1,429        1.16       29.08
          dfrG |      1,429        1.16       30.24
          dfrK |      1,429        1.16       31.40
          ermA |      1,429        1.16       32.57
          ermB |      1,429        1.16       33.73
          ermC |      1,429        1.16       34.89
          ermT |      1,429        1.16       36.06
          ermY |      1,429        1.16       37.22
           eta |      1,427        1.16       38.38
           etb |      1,427        1.16       39.54
           etd |      1,428        1.16       40.70
          fusA |      1,428        1.16       41.87
          fusB |      1,429        1.16       43.03
          fusC |      1,429        1.16       44.19
          grlA |      1,428        1.16       45.36
          gyrA |      1,429        1.16       46.52
          lnuA |      1,429        1.16       47.68
          lnuB |      1,429        1.16       48.84
           luk |      1,429        1.16       50.01
          lukM |      1,429        1.16       51.17
         lukMF |      1,427        1.16       52.33
        lukPVF |      1,429        1.16       53.50
        lukPVS |      1,429        1.16       54.66
          mecA |      1,429        1.16       55.82
          mecC |      1,429        1.16       56.99
          mphC |      1,429        1.16       58.15
          msrA |      1,429        1.16       59.31
          mupA |      1,429        1.16       60.48
          mupB |      1,429        1.16       61.64
          qacA |      1,429        1.16       62.80
          qacB |      1,429        1.16       63.97
       qacCsmr |      1,429        1.16       65.13
          rpoB |      1,427        1.16       66.29
           sak |      1,426        1.16       67.45
          sasX |      1,427        1.16       68.61
          sat4 |      1,427        1.16       69.77
           scn |      1,426        1.16       70.93
           sea |      1,428        1.16       72.10
           seb |      1,428        1.16       73.26
           sec |      1,427        1.16       74.42
           sed |      1,428        1.16       75.58
           see |      1,429        1.16       76.75
           seg |      1,423        1.16       77.91
           seh |      1,427        1.16       79.07
           sei |      1,426        1.16       80.23
           sej |      1,429        1.16       81.39
          selR |      1,429        1.16       82.55
           sep |      1,429        1.16       83.72
           seu |      1,427        1.16       84.88
           str |      1,429        1.16       86.04
          tetK |      1,429        1.16       87.21
          tetL |      1,429        1.16       88.37
          tetM |      1,429        1.16       89.53
          tetO |      1,429        1.16       90.70
         tsst1 |      1,428        1.16       91.86
          vanA |      1,429        1.16       93.02
          vanB |      1,429        1.16       94.18
          vanC |      1,429        1.16       95.35
          vgaA |      1,429        1.16       96.51
        vgaALC |      1,429        1.16       97.67
          vgaB |      1,429        1.16       98.84
          vgbA |      1,429        1.16      100.00
---------------+-----------------------------------
         Total |    122,848      100.00

. use pipeline_clean_all_values_wide, clear

. merge 1:1 sample site using mykrobe_old, update

    Result                           # of obs.
    -----------------------------------------
    not matched                       179,416
        from master                    86,877  (_merge==1)
        from using                     92,539  (_merge==2)

    matched                            30,338
        not updated                    30,338  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. tab site _merge

               |              _merge
          site | master on  using onl  matched ( |     Total
---------------+---------------------------------+----------
          IsaB |         0      1,429          0 |     1,429 
      aac6aph2 |     1,379          0          0 |     1,379 
      aacAaphD |         0      1,429          0 |     1,429 
    aadDaph4Ia |         0      1,429          0 |     1,429 
    aadEant6Ia |         0      1,429          0 |     1,429 
    aaddaph4ia |     1,379          0          0 |     1,379 
    aadeant6ia |     1,379          0          0 |     1,379 
        ant9Ia |         0      1,429          0 |     1,429 
        ant9Ib |         0      1,429          0 |     1,429 
        ant9ia |     1,379          0          0 |     1,379 
        ant9ib |     1,379          0          0 |     1,379 
        aph2Ic |         0      1,429          0 |     1,429 
        aph2ic |     1,379          0          0 |     1,379 
  aphA3aph3III |         0      1,429          0 |     1,429 
  apha3aph3iii |     1,379          0          0 |     1,379 
          arcA |         0      1,428          0 |     1,428 
          arcB |         0      1,429          0 |     1,429 
          arcC |         0      1,429          0 |     1,429 
          arcD |         0      1,427          0 |     1,427 
          arca |     1,379          0          0 |     1,379 
          arcb |     1,379          0          0 |     1,379 
          arcc |     1,379          0          0 |     1,379 
          arcd |     1,379          0          0 |     1,379 
          blaZ |         0      1,429          0 |     1,429 
          blaz |     1,379          0          0 |     1,379 
           cat |         0         50      1,379 |     1,429 
          ccrA |         0      1,428          0 |     1,428 
          ccrB |         0      1,429          0 |     1,429 
         ccrCa |         0      1,429          0 |     1,429 
         ccrCb |         0      1,428          0 |     1,428 
         ccrCc |         0      1,429          0 |     1,429 
          ccra |     1,379          0          0 |     1,379 
          ccrb |     1,379          0          0 |     1,379 
         ccrca |     1,379          0          0 |     1,379 
         ccrcb |     1,379          0          0 |     1,379 
         ccrcc |     1,379          0          0 |     1,379 
           cfr |         0         50      1,379 |     1,429 
           chp |         0         50      1,379 |     1,429 
          dfrA |         0      1,429          0 |     1,429 
          dfrB |         0      1,429          0 |     1,429 
          dfrC |         0      1,429          0 |     1,429 
          dfrD |         0      1,429          0 |     1,429 
          dfrG |         0      1,429          0 |     1,429 
          dfrK |         0      1,429          0 |     1,429 
          dfra |     1,379          0          0 |     1,379 
          dfrb |     1,379          0          0 |     1,379 
          dfrc |     1,379          0          0 |     1,379 
          dfrd |     1,379          0          0 |     1,379 
          dfrg |     1,379          0          0 |     1,379 
          dfrk |     1,379          0          0 |     1,379 
          ermA |         0      1,429          0 |     1,429 
          ermB |         0      1,429          0 |     1,429 
          ermC |         0      1,429          0 |     1,429 
          ermT |         0      1,429          0 |     1,429 
          ermY |         0      1,429          0 |     1,429 
          erma |     1,379          0          0 |     1,379 
          ermb |     1,379          0          0 |     1,379 
          ermc |     1,379          0          0 |     1,379 
          ermt |     1,379          0          0 |     1,379 
          ermy |     1,379          0          0 |     1,379 
           eta |         0         49      1,379 |     1,428 
           etb |         0         49      1,379 |     1,428 
           etd |         0         50      1,379 |     1,429 
          fusA |         0      1,428          0 |     1,428 
          fusB |         0      1,429          0 |     1,429 
          fusC |         0      1,429          0 |     1,429 
          fusa |     1,379          0          0 |     1,379 
          fusb |     1,379          0          0 |     1,379 
          fusc |     1,379          0          0 |     1,379 
          grlA |         0      1,428          0 |     1,428 
          grla |     1,379          0          0 |     1,379 
          gyrA |         0      1,429          0 |     1,429 
          gyra |     1,379          0          0 |     1,379 
          iles |     1,379          0          0 |     1,379 
          isab |     1,379          0          0 |     1,379 
          lnuA |         0      1,429          0 |     1,429 
          lnuB |         0      1,429          0 |     1,429 
          lnua |     1,379          0          0 |     1,379 
          lnub |     1,379          0          0 |     1,379 
           luk |         0      1,429          0 |     1,429 
          lukM |         0      1,429          0 |     1,429 
         lukMF |         0      1,427          0 |     1,427 
        lukPVF |         0      1,429          0 |     1,429 
        lukPVS |         0      1,429          0 |     1,429 
          lukm |     1,379          0          0 |     1,379 
         lukmf |     1,379          0          0 |     1,379 
        lukpvf |     1,379          0          0 |     1,379 
        lukpvs |     1,379          0          0 |     1,379 
          mecA |         0      1,429          0 |     1,429 
          mecC |         0      1,429          0 |     1,429 
          meca |     1,379          0          0 |     1,379 
          mecc |     1,379          0          0 |     1,379 
          mphC |         0      1,429          0 |     1,429 
          mphc |     1,379          0          0 |     1,379 
          msrA |         0      1,429          0 |     1,429 
          msra |     1,379          0          0 |     1,379 
          mupA |         0      1,429          0 |     1,429 
          mupB |         0      1,429          0 |     1,429 
          mupa |     1,379          0          0 |     1,379 
          mupb |     1,379          0          0 |     1,379 
          qacA |         0      1,429          0 |     1,429 
          qacB |         0      1,429          0 |     1,429 
       qacCsmr |         0      1,429          0 |     1,429 
          qaca |     1,379          0          0 |     1,379 
          qacb |     1,379          0          0 |     1,379 
       qaccsmr |     1,379          0          0 |     1,379 
          rpoB |         0      1,427          0 |     1,427 
          rpob |     1,379          0          0 |     1,379 
           sak |         0         50      1,379 |     1,429 
          sasX |         0      1,427          0 |     1,427 
          sasx |     1,379          0          0 |     1,379 
          sat4 |         0         50      1,379 |     1,429 
           scn |         0         50      1,379 |     1,429 
           sea |         0         50      1,379 |     1,429 
           seb |         0         50      1,379 |     1,429 
           sec |         0         49      1,379 |     1,428 
           sed |         0         49      1,379 |     1,428 
           see |         0         50      1,379 |     1,429 
           seg |         0         50      1,379 |     1,429 
           seh |         0         50      1,379 |     1,429 
           sei |         0         50      1,379 |     1,429 
           sej |         0         50      1,379 |     1,429 
          selR |         0      1,429          0 |     1,429 
          selr |     1,379          0          0 |     1,379 
           sep |         0         50      1,379 |     1,429 
           seu |         0         50      1,379 |     1,429 
           str |         0         50      1,379 |     1,429 
          tetK |         0      1,429          0 |     1,429 
          tetL |         0      1,429          0 |     1,429 
          tetM |         0      1,429          0 |     1,429 
          tetO |         0      1,429          0 |     1,429 
          tetk |     1,379          0          0 |     1,379 
          tetl |     1,379          0          0 |     1,379 
          tetm |     1,379          0          0 |     1,379 
          teto |     1,379          0          0 |     1,379 
         tsst1 |         0         50      1,379 |     1,429 
          vanA |         0      1,429          0 |     1,429 
          vanB |         0      1,429          0 |     1,429 
          vanC |         0      1,429          0 |     1,429 
          vana |     1,379          0          0 |     1,379 
          vanb |     1,379          0          0 |     1,379 
          vanc |     1,379          0          0 |     1,379 
          vgaA |         0      1,429          0 |     1,429 
        vgaALC |         0      1,429          0 |     1,429 
          vgaB |         0      1,429          0 |     1,429 
          vgaa |     1,379          0          0 |     1,379 
          vgab |     1,379          0          0 |     1,379 
          vgbA |         0      1,429          0 |     1,429 
          vgba |     1,379          0          0 |     1,379 
---------------+---------------------------------+----------
         Total |    86,877     92,539     30,338 |   209,754 


. use mykrobe_old
no; data in memory would be lost
r(4);

. use mykrobe_old, clear

. replace site = lower(site)
(90,014 real changes made)

. save mykrobe_old
file mykrobe_old.dta already exists
r(602);

. save mykrobe_old, replace
file mykrobe_old.dta saved

. use pipeline_clean_all_values_wide, clear

. merge 1:1 sample site using mykrobe_old, update

    Result                           # of obs.
    -----------------------------------------
    not matched                        11,178
        from master                     2,758  (_merge==1)
        from using                      8,420  (_merge==2)

    matched                           114,457
        not updated                   114,457  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. tab site _merge

               |              _merge
          site | master on  using onl  matched ( |     Total
---------------+---------------------------------+----------
      aac6aph2 |     1,379          0          0 |     1,379 
      aacaaphd |         0      1,429          0 |     1,429 
    aaddaph4ia |         0         50      1,379 |     1,429 
    aadeant6ia |         0         50      1,379 |     1,429 
        ant9ia |         0         50      1,379 |     1,429 
        ant9ib |         0         50      1,379 |     1,429 
        aph2ic |         0         50      1,379 |     1,429 
  apha3aph3iii |         0         50      1,379 |     1,429 
          arca |         0         49      1,379 |     1,428 
          arcb |         0         50      1,379 |     1,429 
          arcc |         0         50      1,379 |     1,429 
          arcd |         0         48      1,379 |     1,427 
          blaz |         0         50      1,379 |     1,429 
           cat |         0         50      1,379 |     1,429 
          ccra |         0         49      1,379 |     1,428 
          ccrb |         0         50      1,379 |     1,429 
         ccrca |         0         50      1,379 |     1,429 
         ccrcb |         0         49      1,379 |     1,428 
         ccrcc |         0         50      1,379 |     1,429 
           cfr |         0         50      1,379 |     1,429 
           chp |         0         50      1,379 |     1,429 
          dfra |         0         50      1,379 |     1,429 
          dfrb |         0         50      1,379 |     1,429 
          dfrc |         0         50      1,379 |     1,429 
          dfrd |         0         50      1,379 |     1,429 
          dfrg |         0         50      1,379 |     1,429 
          dfrk |         0         50      1,379 |     1,429 
          erma |         0         50      1,379 |     1,429 
          ermb |         0         50      1,379 |     1,429 
          ermc |         0         50      1,379 |     1,429 
          ermt |         0         50      1,379 |     1,429 
          ermy |         0         50      1,379 |     1,429 
           eta |         0         49      1,379 |     1,428 
           etb |         0         49      1,379 |     1,428 
           etd |         0         50      1,379 |     1,429 
          fusa |         0         49      1,379 |     1,428 
          fusb |         0         50      1,379 |     1,429 
          fusc |         0         50      1,379 |     1,429 
          grla |         0         49      1,379 |     1,428 
          gyra |         0         50      1,379 |     1,429 
          iles |     1,379          0          0 |     1,379 
          isab |         0         50      1,379 |     1,429 
          lnua |         0         50      1,379 |     1,429 
          lnub |         0         50      1,379 |     1,429 
           luk |         0      1,429          0 |     1,429 
          lukm |         0         50      1,379 |     1,429 
         lukmf |         0         48      1,379 |     1,427 
        lukpvf |         0         50      1,379 |     1,429 
        lukpvs |         0         50      1,379 |     1,429 
          meca |         0         50      1,379 |     1,429 
          mecc |         0         50      1,379 |     1,429 
          mphc |         0         50      1,379 |     1,429 
          msra |         0         50      1,379 |     1,429 
          mupa |         0         50      1,379 |     1,429 
          mupb |         0         50      1,379 |     1,429 
          qaca |         0         50      1,379 |     1,429 
          qacb |         0         50      1,379 |     1,429 
       qaccsmr |         0         50      1,379 |     1,429 
          rpob |         0         48      1,379 |     1,427 
           sak |         0         50      1,379 |     1,429 
          sasx |         0         48      1,379 |     1,427 
          sat4 |         0         50      1,379 |     1,429 
           scn |         0         50      1,379 |     1,429 
           sea |         0         50      1,379 |     1,429 
           seb |         0         50      1,379 |     1,429 
           sec |         0         49      1,379 |     1,428 
           sed |         0         49      1,379 |     1,428 
           see |         0         50      1,379 |     1,429 
           seg |         0         50      1,379 |     1,429 
           seh |         0         50      1,379 |     1,429 
           sei |         0         50      1,379 |     1,429 
           sej |         0         50      1,379 |     1,429 
          selr |         0         50      1,379 |     1,429 
           sep |         0         50      1,379 |     1,429 
           seu |         0         50      1,379 |     1,429 
           str |         0         50      1,379 |     1,429 
          tetk |         0         50      1,379 |     1,429 
          tetl |         0         50      1,379 |     1,429 
          tetm |         0         50      1,379 |     1,429 
          teto |         0         50      1,379 |     1,429 
         tsst1 |         0         50      1,379 |     1,429 
          vana |         0         50      1,379 |     1,429 
          vanb |         0         50      1,379 |     1,429 
          vanc |         0         50      1,379 |     1,429 
          vgaa |         0         50      1,379 |     1,429 
        vgaalc |         0      1,429          0 |     1,429 
          vgab |         0         50      1,379 |     1,429 
          vgba |         0         50      1,379 |     1,429 
---------------+---------------------------------+----------
         Total |     2,758      8,420    114,457 |   125,635 


. drop if _merge!=3
(11,178 observations deleted)

. tab ValueAll value

           |                                               value
  ValueAll |   114:P-H    150:H-R     31:H-N    326:T-I  326:T-I..    404:P-L    404:P-Q    406:P-L     41:L-F |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
       AAA |         1          0          1          1          1          1          3          0          0 |    96,497 
       AAP |         0          0          0          0          0          0          0          0          0 |        23 
       APA |         0          0          0          0          0          0          0          0          0 |       158 
       APP |         0          0          0          0          0          0          0          0          0 |       256 
       PAA |         0          0          0          0          0          0          0          0          0 |         2 
       PAP |         0          1          1          0          0          0          1          2          1 |       610 
       PPA |         0          0          0          0          0          0          0          0          0 |       163 
       PPP |         0          5          0          0          0          0          0          0          0 |    10,578 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |         1          6          2          1          1          1          4          2          1 |   108,287 


           |                                               value
  ValueAll |   452:G-C  452:G-C..    452:G-S    453:M-I    457:H-Q    457:H-Y    461:L-F  461:L-F..    461:L-K |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
       AAA |         2          1          0          5          0          0          1          0          1 |    96,497 
       AAP |         0          0          0          0          0          0          0          0          0 |        23 
       APA |         0          0          0          0          0          0          0          0          0 |       158 
       APP |         0          0          0          0          0          0          0          0          0 |       256 
       PAA |         0          0          0          0          0          0          0          0          0 |         2 
       PAP |         0          0          1          0          1          6          0          1         22 |       610 
       PPA |         0          0          0          0          0          0          0          0          0 |       163 
       PPP |         0          0          0          0          0          0          0          0          0 |    10,578 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |         2          1          1          5          1          6          1          1         23 |   108,287 


           |                                               value
  ValueAll |   461:L-S    464:R-H    464:R-S    464:S-P    468:Q-R    471:D-Y    477:A-D    481:H-N  481:H-N.. |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
       AAA |         0          1          5          0          0          5          0          1          0 |    96,497 
       AAP |         0          0          0          0          0          0          0          0          0 |        23 
       APA |         0          0          0          0          1          0          0          0          0 |       158 
       APP |         0          0          0          0          0          0          0          0          0 |       256 
       PAA |         0          0          0          0          0          0          0          0          0 |         2 
       PAP |        17          0          0          1          0          0          0         14          0 |       610 
       PPA |         0          0          0          0          0          0          0          0          0 |       163 
       PPP |         0          0          0          0          0          0          1          2          1 |    10,578 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |        17          1          5          1          1          5          1         17          1 |   108,287 


           |                                               value
  ValueAll |   481:H-Y     80:S-F  80:S-F ..     80:S-Y     84:S-A     84:S-L     90:V-I  90:V-I ..     99:F-S |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
       AAA |         0          2          0          1          1          6          0          0          1 |    96,497 
       AAP |         0          0          0          0          0          0          1          1          0 |        23 
       APA |         0          0          0          0          0          0          0          0          0 |       158 
       APP |         0          0          0          0          0          0          0          0          0 |       256 
       PAA |         0          0          0          0          0          1          0          0          0 |         2 
       PAP |         2          3          0          0          0        212          6          0          0 |       610 
       PPA |         0          0          0          0          0          0          0          0          0 |       163 
       PPP |         3        294          2          3          0          2          0          0          0 |    10,578 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |         5        299          2          4          1        221          7          1          1 |   108,287 


           |                         value
  ValueAll | 99:F-S ..     99:F-Y  99:F-Y ..          A          P |     Total
-----------+-------------------------------------------------------+----------
       AAA |         0          1          0     95,667        788 |    96,497 
       AAP |         0          0          0          6         15 |        23 
       APA |         0          0          0         31        126 |       158 
       APP |         0          0          0          0        256 |       256 
       PAA |         0          0          0          0          1 |         2 
       PAP |         2         34          0          1        281 |       610 
       PPA |         0          0          0          0        163 |       163 
       PPP |         0         37          1         12     10,215 |    10,578 
-----------+-------------------------------------------------------+----------
     Total |         2         72          1     95,717     11,845 |   108,287 


. drop if ValueAll=="AAA" | ValueAll=="PPP"
(113,240 observations deleted)

. tab ValueAll value

           |                                               value
  ValueAll |   150:H-R     31:H-N    404:P-Q    406:P-L     41:L-F    452:G-S    457:H-Q    457:H-Y  461:L-F.. |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
       AAP |         0          0          0          0          0          0          0          0          0 |        23 
       APA |         0          0          0          0          0          0          0          0          0 |       158 
       APP |         0          0          0          0          0          0          0          0          0 |       256 
       PAA |         0          0          0          0          0          0          0          0          0 |         2 
       PAP |         1          1          1          2          1          1          1          6          1 |       610 
       PPA |         0          0          0          0          0          0          0          0          0 |       163 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |         1          1          1          2          1          1          1          6          1 |     1,212 


           |                                               value
  ValueAll |   461:L-K    461:L-S    464:S-P    468:Q-R    481:H-N    481:H-Y     80:S-F     84:S-L     90:V-I |     Total
-----------+---------------------------------------------------------------------------------------------------+----------
       AAP |         0          0          0          0          0          0          0          0          1 |        23 
       APA |         0          0          0          1          0          0          0          0          0 |       158 
       APP |         0          0          0          0          0          0          0          0          0 |       256 
       PAA |         0          0          0          0          0          0          0          1          0 |         2 
       PAP |        22         17          1          0         14          2          3        212          6 |       610 
       PPA |         0          0          0          0          0          0          0          0          0 |       163 
-----------+---------------------------------------------------------------------------------------------------+----------
     Total |        22         17          1          1         14          2          3        213          7 |     1,212 


           |                         value
  ValueAll | 90:V-I ..  99:F-S ..     99:F-Y          A          P |     Total
-----------+-------------------------------------------------------+----------
       AAP |         1          0          0          6         15 |        23 
       APA |         0          0          0         31        126 |       158 
       APP |         0          0          0          0        256 |       256 
       PAA |         0          0          0          0          1 |         2 
       PAP |         0          2         34          1        281 |       610 
       PPA |         0          0          0          0        163 |       163 
-----------+-------------------------------------------------------+----------
     Total |         1          2         34         38        842 |     1,212 


. tab value

          value |      Freq.     Percent        Cum.
----------------+-----------------------------------
        150:H-R |          1        0.08        0.08
         31:H-N |          1        0.08        0.17
        404:P-Q |          1        0.08        0.25
        406:P-L |          2        0.17        0.41
         41:L-F |          1        0.08        0.50
        452:G-S |          1        0.08        0.58
        457:H-Q |          1        0.08        0.66
        457:H-Y |          6        0.50        1.16
461:L-F 404:P-L |          1        0.08        1.24
        461:L-K |         22        1.82        3.05
        461:L-S |         17        1.40        4.46
        464:S-P |          1        0.08        4.54
        468:Q-R |          1        0.08        4.62
        481:H-N |         14        1.16        5.78
        481:H-Y |          2        0.17        5.94
         80:S-F |          3        0.25        6.19
         84:S-L |        213       17.57       23.76
         90:V-I |          7        0.58       24.34
 90:V-I 326:T-I |          1        0.08       24.42
  99:F-S 99:F-Y |          2        0.17       24.59
         99:F-Y |         34        2.81       27.39
              A |         38        3.14       30.53
              P |        842       69.47      100.00
----------------+-----------------------------------
          Total |      1,212      100.00

. replace value=A if value==""
A not found
r(111);

. replace value="A" if value==""
(5 real changes made)

. replace value="P" if value!="A"
(332 real changes made)

. use pipeline_clean_all_values_wide, clear

. merge 1:1 sample site using mykrobe_old, update

    Result                           # of obs.
    -----------------------------------------
    not matched                        11,178
        from master                     2,758  (_merge==1)
        from using                      8,420  (_merge==2)

    matched                           114,457
        not updated                   114,457  (_merge==3)
        missing updated                     0  (_merge==4)
        nonmissing conflict                 0  (_merge==5)
    -----------------------------------------

. drop if _merge!=3
(11,178 observations deleted)

. drop if ValueAll=="AAA" | ValueAll=="PPP"
(113,240 observations deleted)

. tab ValueAll

   ValueAll |      Freq.     Percent        Cum.
------------+-----------------------------------
        AAP |         24        1.97        1.97
        APA |        158       12.98       14.95
        APP |        256       21.04       35.99
        PAA |          2        0.16       36.15
        PAP |        614       50.45       86.61
        PPA |        163       13.39      100.00
------------+-----------------------------------
      Total |      1,217      100.00

. tab site ValueAll

               |                             ValueAll
          site |       AAP        APA        APP        PAA        PAP        PPA |     Total
---------------+------------------------------------------------------------------+----------
    aaddaph4ia |         0          2          0          0          0          0 |         2 
    aadeant6ia |         0         28          2          0          0          0 |        30 
        ant9ia |         0          4          3          0          0          0 |         7 
  apha3aph3iii |         0          0          1          0          0          0 |         1 
          arca |         0          1          0          0          0          0 |         1 
          arcb |         0          0          0          0          0          6 |         6 
          arcc |         0          0          0          0          0          6 |         6 
          arcd |         0          0          0          0          0          6 |         6 
          blaz |         4          1          3          1        282          0 |       291 
          ccra |         0          2          3          0          0          0 |         5 
          ccrb |         9          1         22          0          0          1 |        33 
         ccrca |         0          8          1          0          0          9 |        18 
         ccrcb |         0         22          0          0          0         22 |        44 
         ccrcc |         0         16          1          0          0          6 |        23 
           cfr |         0          0          1          0          0          0 |         1 
           chp |         0          1         46          0          0          0 |        47 
          dfra |         0          3          0          0          0          1 |         4 
          dfrb |         0          0          0          0         39          0 |        39 
          dfrc |         0          0          3          0          0         34 |        37 
          dfrg |         0          1          0          0          0          0 |         1 
          erma |         0          1          5          0          0          0 |         6 
          ermb |         0          1          0          0          0          0 |         1 
          ermc |         0         10          2          0          0          0 |        12 
           eta |         0          1          0          0          0          0 |         1 
           etb |         0          1          1          0          0          0 |         2 
           etd |         0          1          1          0          0          0 |         2 
          fusa |         2          0          0          0         57          0 |        59 
          fusb |         0          2          0          0          0          0 |         2 
          fusc |         0          1          2          0          0          0 |         3 
          grla |         1          0          0          0          7          0 |         8 
          gyra |         0          0          0          1        212          0 |       213 
          lnua |         6          0          0          0          0          0 |         6 
         lukmf |         0          0          0          0          0          6 |         6 
        lukpvf |         0          2          0          0          0          0 |         2 
        lukpvs |         0          3          1          0          0          0 |         4 
          meca |         0          1          2          0          0          0 |         3 
          mphc |         0          1          0          0          0          0 |         1 
          msra |         0          1          0          0          0          0 |         1 
          mupa |         2          0          0          0          0          0 |         2 
          qaca |         0          1          1          0          0          0 |         2 
          qacb |         0          2          0          0          0         44 |        46 
       qaccsmr |         0          7          2          0          0          1 |        10 
          rpob |         0          1          0          0         17          0 |        18 
           sak |         0          3          5          0          0          0 |         8 
          sasx |         0          1          0          0          0         14 |        15 
          sat4 |         0          2          1          0          0          0 |         3 
           scn |         0          3         15          0          0          0 |        18 
           sea |         0          1          3          0          0          0 |         4 
           seb |         0          1          2          0          0          0 |         3 
           sec |         0          1          4          0          0          0 |         5 
           seg |         0          6         20          0          0          0 |        26 
           seh |         0          2          2          0          0          0 |         4 
           sei |         0          3         33          0          0          6 |        42 
           sep |         0          0          2          0          0          1 |         3 
           seu |         0          2         57          0          0          0 |        59 
          tetk |         0          4          4          0          0          0 |         8 
          tetm |         0          1          1          0          0          0 |         2 
         tsst1 |         0          1          4          0          0          0 |         5 
---------------+------------------------------------------------------------------+----------
         Total |        24        158        256          2        614        163 |     1,217 


. tab ValueAll value if site=="blaz"

           |         value
  ValueAll |         A          P |     Total
-----------+----------------------+----------
       AAP |         0          4 |         4 
       APA |         0          1 |         1 
       APP |         0          3 |         3 
       PAA |         0          1 |         1 
       PAP |         1        281 |       282 
-----------+----------------------+----------
     Total |         1        290 |       291 


. list sample site if ValueAll=="PAP" & value =="P"

      +-----------------------------+
      |               sample   site |
      |-----------------------------|
   1. |            C00000784   blaz |
   9. |            C00000788   blaz |
  16. |            C00000795   blaz |
  19. |            C00000796   blaz |
  22. |            C00000799   blaz |
      |-----------------------------|
  28. |            C00000805   blaz |
  31. |            C00000806   blaz |
  37. |            C00000814   blaz |
  45. |            C00000819   blaz |
  48. |            C00000825   blaz |
      |-----------------------------|
  50. |            C00000827   blaz |
  54. |            C00000830   blaz |
  58. |            C00000834   blaz |
  60. |            C00000837   blaz |
  62. |            C00000839   blaz |
      |-----------------------------|
  65. |            C00000845   blaz |
  67. |            C00000846   blaz |
  69. |            C00000848   blaz |
  71. |            C00000849   blaz |
  74. |            C00000851   blaz |
      |-----------------------------|
  77. |            C00000852   blaz |
  79. |            C00000857   blaz |
  82. |            C00000860   blaz |
  95. |            C00001108   blaz |
  96. |            C00001110   blaz |
      |-----------------------------|
  97. |            C00001113   blaz |
 100. |            C00001139   blaz |
 103. |            C00001189   blaz |
 104. |            C00001190   blaz |
 105. |            C00001191   blaz |
      |-----------------------------|
 106. |            C00001192   blaz |
 107. |            C00001193   blaz |
 108. |            C00001194   blaz |
 109. |            C00001219   blaz |
 111. |            C00001220   blaz |
      |-----------------------------|
 113. |            C00001221   blaz |
 115. |            C00001222   blaz |
 117. |            C00001223   blaz |
 119. |            C00001224   blaz |
 121. |            C00001225   blaz |
      |-----------------------------|
 123. |            C00001226   blaz |
 126. |            C00001227   blaz |
 128. |            C00001228   blaz |
 130. |            C00001229   blaz |
 132. |            C00001230   blaz |
      |-----------------------------|
 134. |            C00001231   blaz |
 136. |            C00001232   blaz |
 138. |            C00001233   blaz |
 140. |            C00001234   blaz |
 142. |            C00001235   blaz |
      |-----------------------------|
 145. |            C00001236   blaz |
 147. |            C00001237   blaz |
 149. |            C00001238   blaz |
 151. |            C00001239   blaz |
 153. |            C00001240   blaz |
      |-----------------------------|
 157. |            C00001255   blaz |
 160. |            C00001274   blaz |
 161. |            C00001280   blaz |
 163. |            C00001282   blaz |
 165. |            C00001386   blaz |
      |-----------------------------|
 169. |            C00001388   blaz |
 171. |            C00001397   blaz |
 173. |            C00001399   blaz |
 176. |            C00001400   blaz |
 178. |            C00001401   blaz |
      |-----------------------------|
 183. |            C00001453   blaz |
 185. |            C00002623   blaz |
 187. |            C00002624   blaz |
 189. |            C00002626   blaz |
 194. |            C00002657   blaz |
      |-----------------------------|
 196. |            C00003086   blaz |
 199. |            C00003093   blaz |
 202. |            C00003096   blaz |
 204. |            C00003100   blaz |
 206. |            C00003103   blaz |
      |-----------------------------|
 209. |            C00003107   blaz |
 210. |            C00003111   blaz |
 214. |            C00003114   blaz |
 219. |            C00003125   blaz |
 222. |            C00003127   blaz |
      |-----------------------------|
 224. |            C00003128   blaz |
 225. |            C00003130   blaz |
 230. |            C00003132   blaz |
 232. |            C00003133   blaz |
 238. |            C00003137   blaz |
      |-----------------------------|
 245. |            C00003141   blaz |
 246. |            C00003142   blaz |
 248. |            C00003147   blaz |
 249. |            C00003149   blaz |
 251. |            C00003151   blaz |
      |-----------------------------|
 260. |            C00003155   blaz |
 267. |            C00003166   blaz |
 268. |            C00003168   blaz |
 270. |            C00003174   blaz |
 274. |            C00003183   blaz |
      |-----------------------------|
 276. |            C00003187   blaz |
 278. |            C00003191   blaz |
 280. |            C00003193   blaz |
 283. |            C00003197   blaz |
 284. |            C00003201   blaz |
      |-----------------------------|
 286. |            C00003203   blaz |
 291. |            C00003208   blaz |
 295. |            C00003215   blaz |
 296. |            C00003216   blaz |
 297. |            C00003218   blaz |
      |-----------------------------|
 300. |            C00003223   blaz |
 304. |            C00003227   blaz |
 305. |            C00003228   blaz |
 309. |            C00003235   blaz |
 312. |            C00003242   blaz |
      |-----------------------------|
 315. |            C00003247   blaz |
 323. |            C00003250   blaz |
 326. |            C00003251   blaz |
 330. |            C00003255   blaz |
 333. |            C00003267   blaz |
      |-----------------------------|
 334. |            C00003268   blaz |
 336. |            C00003269   blaz |
 339. |            C00003271   blaz |
 350. |            C00003284   blaz |
 352. |            C00003286   blaz |
      |-----------------------------|
 353. |            C00003289   blaz |
 355. |            C00003290   blaz |
 358. |            C00003295   blaz |
 359. |            C00003298   blaz |
 360. |            C00003301   blaz |
      |-----------------------------|
 366. |            C00003302   blaz |
 368. |            C00003303   blaz |
 372. |            C00003307   blaz |
 375. |            C00003309   blaz |
 378. |            C00003315   blaz |
      |-----------------------------|
 402. |            C00003321   blaz |
 406. |            C00003323   blaz |
 409. |            C00003330   blaz |
 412. |            C00003333   blaz |
 419. |            C00003339   blaz |
      |-----------------------------|
 423. |            C00003340   blaz |
 431. |            C00003343   blaz |
 437. |            C00003350   blaz |
 439. |            C00003351   blaz |
 442. |            C00003354   blaz |
      |-----------------------------|
 447. |            C00003357   blaz |
 449. |            C00003360   blaz |
 451. |            C00003362   blaz |
 453. |            C00003370   blaz |
 454. |            C00003371   blaz |
      |-----------------------------|
 456. |            C00003374   blaz |
 462. |            C00003379   blaz |
 465. |            C00003381   blaz |
 468. |            C00003382   blaz |
 482. |            C00003386   blaz |
      |-----------------------------|
 492. |            C00003395   blaz |
 502. |            C00003399   blaz |
 503. |            C00003405   blaz |
 510. |            C00003407   blaz |
 512. |            C00003410   blaz |
      |-----------------------------|
 515. |            C00003411   blaz |
 520. |            C00003413   blaz |
 522. |            C00003414   blaz |
 536. |            C00003423   blaz |
 543. |            C00003425   blaz |
      |-----------------------------|
 552. |            C00007064   blaz |
 554. |            C00007066   blaz |
 557. |            C00007067   blaz |
 560. |            C00007079   blaz |
 563. |            C00007082   blaz |
      |-----------------------------|
 568. |            C00007086   blaz |
 570. |            C00007089   blaz |
 572. |            C00007093   blaz |
 575. |            C00007096   blaz |
 579. |            C00007098   blaz |
      |-----------------------------|
 582. |            C00007106   blaz |
 584. |            C00007114   blaz |
 586. |            C00007116   blaz |
 589. |            C00008632   blaz |
 596. |            C00008970   blaz |
      |-----------------------------|
 599. |            C00008994   blaz |
 601. |            C00009008   blaz |
 603. |            C00009018   blaz |
 606. |            C00009029   blaz |
 608. |            C00009030   blaz |
      |-----------------------------|
 611. |            C00012740   blaz |
 614. |            C00012742   blaz |
 617. |            C00012743   blaz |
 618. |            C00012744   blaz |
 623. |            C00012759   blaz |
      |-----------------------------|
 625. |            C00012761   blaz |
 635. |            C00012796   blaz |
 636. |            C00012799   blaz |
 639. |            C00012829   blaz |
 641. |            C00012831   blaz |
      |-----------------------------|
 643. |            C00012833   blaz |
 646. |            C00013159   blaz |
 650. |            C00013163   blaz |
 651. |            C00013164   blaz |
 653. |            C00013174   blaz |
      |-----------------------------|
 654. |            C00013181   blaz |
 658. |            C00013182   blaz |
 659. |            C00013183   blaz |
 660. |            C00013184   blaz |
 661. |            C00013190   blaz |
      |-----------------------------|
 662. |            C00013191   blaz |
 663. |            C00013194   blaz |
 668. |            C00013196   blaz |
 669. |            C00013203   blaz |
 672. |            C00013212   blaz |
      |-----------------------------|
 680. |            C00013217   blaz |
 683. |            C00013223   blaz |
 689. |            C00013236   blaz |
 691. |            C00013237   blaz |
 693. |            C00013238   blaz |
      |-----------------------------|
 695. |            C00013242   blaz |
 696. |            C00013243   blaz |
 697. |            C00013247   blaz |
 700. |            C00013314   blaz |
 704. |            C00013324   blaz |
      |-----------------------------|
 707. |            C00013339   blaz |
 709. |            C00013343   blaz |
 710. |            C00013359   blaz |
 714. |            C00013368   blaz |
 716. |            C00013371   blaz |
      |-----------------------------|
 717. |            C00013374   blaz |
 719. |            C00013381   blaz |
 722. |            C00013396   blaz |
 723. |            C00013397   blaz |
 724. |            C00013399   blaz |
      |-----------------------------|
 728. | H065060092-367-A12-2   blaz |
 731. |     H071660602-163-1   blaz |
 735. | H075000499-369-C12-2   blaz |
 761. |     H100760181-170-2   blaz |
 772. |     H101860122-177-2   blaz |
      |-----------------------------|
 773. |     H102500043-180-2   blaz |
 780. | H104040516-329-C07-2   blaz |
 781. |     H104060122-187-2   blaz |
 787. |     H104420050-188-2   blaz |
 793. |     H104600048-190-2   blaz |
      |-----------------------------|
 815. |     H111200066-118-2   blaz |
 823. |     H111820165-458-2   blaz |
 828. |     H112340069-463-2   blaz |
 830. |     H112820061-464-2   blaz |
 831. |     H113020155-466-2   blaz |
      |-----------------------------|
 840. |     H113560219-469-2   blaz |
 884. |     H114760256-484-1   blaz |
 886. |     H120360008-383-2   blaz |
 895. | H120600059-344-B09-2   blaz |
 902. | H120860096-346-D09-2   blaz |
      |-----------------------------|
 904. |     H121000455-532-1   blaz |
 908. |     H121060252-533-1   blaz |
 912. |     H121120051-535-1   blaz |
 936. | H121580125-347-E09-2   blaz |
 939. |     H122020138-389-2   blaz |
      |-----------------------------|
 942. |     H122140282-391-2   blaz |
 954. |     H122960028-515-1   blaz |
 957. |     H122960030-517-1   blaz |
 960. |     H123020176-551-1   blaz |
 963. |     H123020177-552-1   blaz |
      |-----------------------------|
 966. |     H123020178-553-1   blaz |
 969. |     H123100270-554-1   blaz |
 972. |     H123100271-555-1   blaz |
 976. |     H123120336-557-1   blaz |
 981. |     H123120337-556-1   blaz |
      |-----------------------------|
 985. |     H123120338-558-1   blaz |
 988. |     H123220266-561-1   blaz |
 991. |     H123320438-393-2   blaz |
 993. |     H123420107-133-1   blaz |
1008. |     H124940456-402-1   blaz |
      |-----------------------------|
1030. |     H130660215-405-2   blaz |
1033. |     H131740193-413-2   blaz |
1043. |     H132920375-623-1   blaz |
1060. |     H133060075-630-1   blaz |
1063. |     H133100176-615-1   blaz |
      |-----------------------------|
1073. |     H133180031-619-1   blaz |
1075. |     H133180045-620-1   blaz |
1084. |     H133200302-603-1   blaz |
1134. |     H133900439-581-1   blaz |
1137. |     H133920237-578-1   blaz |
      |-----------------------------|
1141. |     H133960268-568-1   blaz |
1144. |     H133960269-569-1   blaz |
1155. | RH08000015-282-D01-2   blaz |
1172. | RH11000072-288-B02-2   blaz |
1215. | RH12000656-365-G11-2   blaz |
      |-----------------------------|
1216. |     RH13000429-211-1   blaz |
      +-----------------------------+

. preserve

. keep sample site if ValueAll=="PAP" & value =="P"
invalid syntax
r(198);

. keep ValueAll=="PAP" & value =="P"
== invalid name
r(198);

. keep if ValueAll=="PAP" & value =="P"
(936 observations deleted)

. keep sample site valuezam value

. rename value ValueOld

. rename valuez ValueNew

. display _N
281

.   export excel using "E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\blaZ_site_disagreements.xls", replace firstrow(variab
> les)
file E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\blaZ_site_disagreements.xls saved

. 
. use pipeline_clean_all_values_wide, clear

. 
.  keep if ValueAll=="APA" | ValueAll=="PAP"
(116,441 observations deleted)

. 
. 
. 
.   export excel using "E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_site_disagreements.xls", replace firstrow(var
> iables)
file E:\users\amy.mason\Pipeline_27_07_2016\Excel_Outputs\Mykrobe_site_disagreements.xls saved

. 
. 
. 
.  
. 
.  noi di  _N "site-results where mykrobe disgrees with typewriter and genefinder"
774site-results where mykrobe disgrees with typewriter and genefinder

. 
. noi bysort valuez: tab site

----------------------------------------------------------------------------------------------------------------------------------
-> valuezam = A

          site |      Freq.     Percent        Cum.
---------------+-----------------------------------
          blaz |        282       45.93       45.93
          dfrb |         39        6.35       52.28
          fusa |         57        9.28       61.56
          grla |          7        1.14       62.70
          gyra |        212       34.53       97.23
          rpob |         17        2.77      100.00
---------------+-----------------------------------
         Total |        614      100.00

----------------------------------------------------------------------------------------------------------------------------------
-> valuezam = P

          site |      Freq.     Percent        Cum.
---------------+-----------------------------------
      aac6aph2 |          2        1.25        1.25
    aaddaph4ia |          2        1.25        2.50
    aadeant6ia |         28       17.50       20.00
        ant9ia |          4        2.50       22.50
          arca |          1        0.63       23.13
          blaz |          1        0.63       23.75
          ccra |          2        1.25       25.00
          ccrb |          1        0.63       25.63
         ccrca |          8        5.00       30.63
         ccrcb |         22       13.75       44.38
         ccrcc |         16       10.00       54.38
           chp |          1        0.63       55.00
          dfra |          3        1.88       56.88
          dfrg |          1        0.63       57.50
          erma |          1        0.63       58.13
          ermb |          1        0.63       58.75
          ermc |         10        6.25       65.00
           eta |          1        0.63       65.63
           etb |          1        0.63       66.25
           etd |          1        0.63       66.88
          fusb |          2        1.25       68.13
          fusc |          1        0.63       68.75
        lukpvf |          2        1.25       70.00
        lukpvs |          3        1.88       71.88
          meca |          1        0.63       72.50
          mphc |          1        0.63       73.13
          msra |          1        0.63       73.75
          qaca |          1        0.63       74.38
          qacb |          2        1.25       75.63
       qaccsmr |          7        4.38       80.00
          rpob |          1        0.63       80.63
           sak |          3        1.88       82.50
          sasx |          1        0.63       83.13
          sat4 |          2        1.25       84.38
           scn |          3        1.88       86.25
           sea |          1        0.63       86.88
           seb |          1        0.63       87.50
           sec |          1        0.63       88.13
           seg |          6        3.75       91.88
           seh |          2        1.25       93.13
           sei |          3        1.88       95.00
           seu |          2        1.25       96.25
          tetk |          4        2.50       98.75
          tetm |          1        0.63       99.38
         tsst1 |          1        0.63      100.00
---------------+-----------------------------------
         Total |        160      100.00


. cd E:\users\amy.mason\Pipeline_27_07_2016
E:\users\amy.mason\Pipeline_27_07_2016

. 
. do Master.do

. ********************************
. * PIPELINE ANALYSIS MASTER DOC
. ********************************
. * MASTER.DO
. 
. * project: staph pipeline
. * author: Amy Mason
. * start date: July 2016
. * raw data files in E:\users\amy.mason\Pipeline_27_07_2016\Inputs
. 
. sysdir set PERSONAL "E:\users\amy.mason\ADO"

. sysdir set STBPLUS  "E:\users\amy.mason\ADO\stbplus"

. sysdir set OLDPLACE "E:\users\amy.mason\ADO\oldplace"

. set logtype text

. 
. *******************
. cd E:\users\amy.mason\Pipeline_27_07_2016\
E:\users\amy.mason\Pipeline_27_07_2016

. 
. set more off

. * data input
. run inputs.do
